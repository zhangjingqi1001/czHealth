# 商品管理模块

# 一、分页查询商品

![image-20230815124434879](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815124434879.png)

## 1.1 实体类

### 1.1.1 Store 仓库

```java
/**
 * 仓库表store表对应的实体类:
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
@ToString
public class Store implements Serializable {

    private static final long serialVersionUID = 4011912702717598523L;
   
    private Integer storeId;//仓库id

    private String storeName;//仓库名称

    private String storeNum;//仓库编码

    private String storeAddress;//仓库地址

    private String concat;//仓库联系人

    private String phone;//仓库联系电话
}
```

![image-20230815124752533](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815124752533.png)



### 1.1.2  Brand 品牌

```java
/**
 * 品牌表brand表对应的实体类:
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
@ToString
public class Brand implements Serializable {

    private Integer brandId;//品牌id

    private String brandName;//品牌名称

    private String brandLeter;//品牌首字母

    private String brandDesc;//品牌描述
}
```

![image-20230815125543769](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815125543769.png)



### 1.1.3 ProductType  商品分类

```java
/**
 * 商品分类表product_type表对应的实体类:
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
@ToString
public class ProductType implements Serializable {

    private Integer typeId;//分类id

    private Integer parentId;//上级分类id

    private String typeCode;//分类代码

    private String typeName;//分类名称

    private String typeDesc;//分类描述

    //自定义List<ProductType>集合属性,用于存储当前分类的所有子级分类
    private List<ProductType> childProductCategory;
}
```



![image-20230815125754166](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815125754166.png)



### 1.1.4 Supply 供应商

```java
/**
 * 供应商表supply表对应的实体类:
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
@ToString
public class Supply implements Serializable {

    private Integer supplyId;//供应商id

    private String supplyNum;//供应商代码

    private String supplyName;//供应商名称

    private String supplyIntroduce;//供应商介绍

    private String concat;//供应商联系人

    private String phone;//供应商联系电话

    private String address;//供应商地址

    private String isDelete;//是否删除状态,0未删除,1删除
}
```

![image-20230815130227455](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815130227455.png)



### 1.1.5 Place 产地

![image-20230815130208570](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815130208570.png)

```java
/**
 * 产地表place表对应的实体类:
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
@ToString
public class Place implements Serializable {

    private Integer placeId;//产地id

    private String placeName;//产地名称

    private String placeNum;//产地代码

    private String introduce;//产地介绍

    private String isDelete;//是否删除状态,0未删除,1删除
}
```



### 1.1.6 Unit 单位

```java
/**
 * 单位表unit表对应的实体类:
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
@ToString
public class Unit implements Serializable {

    private Integer unitId;//单位id

    private String unitName;//单位

    private String unitDesc;//单位描述
}
```

![image-20230815130421129](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815130421129.png)





### 1.1.7 Product 商品

```java
/**
 * 商品表product表对应的实体类:
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
@ToString
public class Product {

    private Integer productId;//商品id

    private Integer storeId;//商品所在仓库id
    private String storeName;//非表中字段 --商品所在仓库名称

    private Integer brandId;//商品所属品牌id
    private String brandName;//非表中字段 -- 商品所属品牌名称

    private String productName;//商品名称

    private String productNum;//商品编码

    private Integer productInvent;//商品库存

    private Integer typeId;//商品所属分类id
    private String typeName;//非表中字段 -- 商品所属分类名称

    private Integer supplyId;//商品供应商id
    private String supplyName;//非表中字段 -- 商品供应商名称

    private Integer placeId;//商品产地id
    private String placeName;//非表中字段 -- 商品产地名称

    private Integer unitId;//商品单位id
    private String unitName;//非表中字段 -- 商品单位名称

    private String introduce;//商品介绍

    private String upDownState;//商品上下架状态,1.上架,0.下架

    private Double inPrice;//商品进价

    private Double salePrice;//商品售价

    private Double memPrice;//商品会员价

    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private Date createTime;//商品的创建时间

    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private Date updateTime;//商品的修改时间

    private Integer createBy;//创建商品的用户id

    private Integer updateBy;//修改商品的用户id

    private String imgs;//商品的图片地址

    @JsonFormat(pattern="yyyy-MM-dd")
    private Date productDate;//商品的生产日期

    @JsonFormat(pattern="yyyy-MM-dd")
    private Date suppDate;//商品的保质期

    private String isOverDate;//非表中字段 -- 商品是否过期,0未过期,1已过期
}
```

![image-20230815134005095](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815134005095.png)





## 1.2 查询所有仓库

为搜索商品仓库下拉框组装数据

### 1.2.1 Mapper

```java
//  查询所有仓库的方法
    public List<Store> findAllStore();
```



```java
<select id="findAllStore" resultType="com.pn.entity.Store">
    select *
    from store
</select>
```



### 1.2.2 Service

```java
@CacheConfig(cacheNames = "com.pn.service.impl.StoreServiceImpl")
@Service
public class StoreServiceImpl implements StoreService {
    @Autowired
    private StoreMapper storeMapper;


    @Cacheable(key = "'all:store'")
    @Override
    public List<Store> queryAllStore() {
        return storeMapper.findAllStore();
    }
}
```



### 1.2.3 Controller

```java
@Slf4j
@RestController
@RequestMapping("/product")
public class ProductController {

//  注入StoreService
    @Autowired
    private StoreService storeService;

    @RequestMapping("/store-list")
    public Result storeList(){
       return Result.ok(storeService.queryAllStore()) ;
    }
}
```



### 1.2.4 效果图

![image-20230815132234669](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815132234669.png)



## 1.3 查询所有品牌

### 1.3.1  Mapper

```java
//  查询所有品牌的方法
    public List<Brand> findAllBrand();
```

```xml
<select id="findAllBrand" resultType="com.pn.entity.Brand">
    select *
    from brand
</select>
```

### 1.3.2 Service

```java
@CacheConfig(cacheNames = "'com.pn.service.impl.BrandServiceImpl'")
@Service
public class BrandServiceImpl implements BrandService {

    @Autowired
    private BrandMapper brandMapper;


    @Cacheable(key = "'all:brand'")
    @Override
    public List<Brand> queryAllBrand() {
        return brandMapper.findAllBrand();
    }
}
```

### 1.3.3 Controller

```java
@CacheConfig(cacheNames = "com.pn.service.impl.BrandServiceImpl")
@Service
public class BrandServiceImpl implements BrandService {

    @Autowired
    private BrandMapper brandMapper;


    @Cacheable(key = "'all:brand'")
    @Override
    public List<Brand> queryAllBrand() {
        return brandMapper.findAllBrand();
    }
}

```

### 1.3.4 效果图

![image-20230815133312021](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815133312021.png)





## 1.4 分页查询商品

**根据仓库 商品名称 品牌 类型 供应商 产地 上下架状态 过期与查询商品并分页**

![image-20230815140448462](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815140448462.png)



### 1.4.1 Mapper

```java
//  查询商品行数的方法
    public Integer findProductRowCount(Product product);

//  分页查询商品的方法
    public List<Product> findProductPage(@Param("page") Page page, @Param("product") Product product);
```



```xml
<select id="findProductRowCount" resultType="java.lang.Integer">
    select count(*) from
    product t1, store t2, brand t3, product_type t4, supply t5,
    place t6, unit t7
    where t1.store_id = t2.store_id and t1.brand_id = t3.brand_id
    and t1.type_id = t4.type_id and t1.supply_id = t5.supply_id
    and t1.place_id = t6.place_id and t1.unit_id = t7.unit_id
    <if test="storeId != null">
        and t1.store_id = #{storeId}
    </if>
    <if test="productName != null and productName != ''">
        and t1.product_name like concat('%',#{productName},'%')
    </if>
    <if test="brandName != null and brandName != ''">
        and t3.brand_name like concat('%', #{brandName}, '%')
    </if>
    <if test="typeName != null and typeName != ''">
        and t4.type_name like concat('%', #{typeName}, '%')
    </if>
    <if test="supplyName != null and supplyName != ''">
        and t5.supply_name like concat('%', #{supplyName}, '%')
    </if>
    <if test="placeName != null and placeName != ''">
        and t6.place_name like concat('%', #{placeName}, '%')
    </if>
    <if test="upDownState != null and upDownState != ''">
        and t1.up_down_state = #{upDownState}
    </if>
    <!--
      如果方法参数Product对象的isOverDate属性值为1(查询已过期商品),则查询
      当前时间大于product表中supp_date列的时间的商品;
      反之如果方法参数Product对象的isOverDate属性值为0(查询未过期商品),则
      查询当前时间小于product表中supp_date列的时间的商品;
    -->
    <if test="isOverDate != null and isOverDate != '' and isOverDate==1">
        and date_format(now(), '%y-%m-%d') &gt; t1.supp_date
    </if>
    <if test="isOverDate != null and isOverDate != '' and isOverDate==0">
        and date_format(now(), '%y-%m-%d') &lt; t1.supp_date
    </if>
</select>

<select id="findProductPage" resultType="com.pn.entity.Product">
    select t1.*, t2.store_name, t3.brand_name, t4.type_name,
    t5.supply_name, t6.place_name, t7.unit_name from
    product t1, store t2, brand t3, product_type t4, supply t5,
    place t6, unit t7
    where t1.store_id = t2.store_id and t1.brand_id = t3.brand_id
    and t1.type_id = t4.type_id and t1.supply_id = t5.supply_id
    and t1.place_id = t6.place_id and t1.unit_id = t7.unit_id
    <if test="product.storeId != null">
        and t1.store_id = #{product.storeId}
    </if>
    <if test="product.productName != null and product.productName != ''">
        and t1.product_name like concat('%',#{product.productName},'%')
    </if>
    <if test="product.brandName != null and product.brandName != ''">
        and t3.brand_name like concat('%', #{product.brandName}, '%')
    </if>
    <if test="product.typeName != null and product.typeName != ''">
        and t4.type_name like concat('%', #{product.typeName}, '%')
    </if>
    <if test="product.supplyName != null and product.supplyName != ''">
        and t5.supply_name like concat('%', #{product.supplyName}, '%')
    </if>
    <if test="product.placeName != null and product.placeName != ''">
        and t6.place_name like concat('%', #{product.placeName}, '%')
    </if>
    <if test="product.upDownState != null and product.upDownState != ''">
        and t1.up_down_state = #{product.upDownState}
    </if>
    <if test="product.isOverDate != null and product.isOverDate != '' and product.isOverDate==1">
        and date_format(now(), '%y-%m-%d') &gt; t1.supp_date
    </if>
    <if test="product.isOverDate != null and product.isOverDate != '' and product.isOverDate==0">
        and date_format(now(), '%y-%m-%d') &lt; t1.supp_date
    </if>
    order by t1.create_time
    limit #{page.limitIndex}, #{page.pageSize}
</select>
```

### 1.4.2 Service

```java
    @Autowired
    private ProductMapper productMapper;

    @Override
    public Page queryProductPage(Page page, Product product) {
//      查询商品行数
        Integer count = productMapper.findProductRowCount(product);
        page.setTotalNum(count);
        page.setLimitIndex(page.getLimitIndex());
        page.setPageCount(page.getPageCount());
//      分页查询商品
        List<Product> productPage = productMapper.findProductPage(page, product);

        page.setResultList(productPage);
        return page;
    }
```

### 1.4.3 Controller

```java
    //分页查询商品的url接口
    @RequestMapping("/product-page-list")
    public Result productListPage(Page page, Product product) {
        page = productService.queryProductPage(page, product);
        return Result.ok(page);
    }
```

### 1.4.4 效果图

![image-20230815145308406](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815145308406.png)





# 二、添加商品

![image-20230815153154763](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815153154763.png)



## 2.1 查询所有分类树

### 2.1.1 Mapper

```java
//  查询所有商品分类的方法
    public List<ProductType>  findAllProductType();
```



```xml
<select id="findAllProductType" resultType="com.pn.entity.ProductType">
    select *
    from product_type
</select>
```

### 2.1.2 Service

```java
@CacheConfig(cacheNames = "com.pn.service.impl.ProductTypeServiceImpl")
@Service
public class ProductTypeServiceImpl implements ProductTypeService {

    @Autowired
    private ProductMapper productMapper;

    @Cacheable(key = "'all:typeTree'")
    @Override
    public List<ProductType> productTypeTree() {
//      查询出所有的商品分类
        List<ProductType> allProductType = productMapper.findAllProductType();
//      将所有商品分类转换成商品分类树
        return allTypeToTypeTree(allProductType,0);
    }

    private List<ProductType> allTypeToTypeTree(List<ProductType> typeList, Integer pid) {
//      拿到n级分类
        List<ProductType> nTypeList = new ArrayList<>();
        for (ProductType productType : typeList) {
            if (productType.getParentId().equals(pid)) {
                nTypeList.add(productType);
            }
        }

//      遍历n级分类，为其找子
        for (ProductType productType : nTypeList) {
//          找子集
            List<ProductType> productTypes = allTypeToTypeTree(typeList, productType.getTypeId());
            productType.setChildProductCategory(productTypes);
        }
        return nTypeList;
    }
}
```



### 2.1.3 Controller

```java
@Autowired
private ProductTypeService productTypeTree;

//查询所有商品分类树的接口
@RequestMapping("/category-tree")
public Result loadTypeTree(){
    return Result.ok(productTypeTree.productTypeTree());
}
```



### 2.1.4 效果图

![image-20230815223112067](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815223112067.png)

## 2.2  查询所有供应商

### 2.2.1 Mapper

```java
//  查询所有供应商的方法
    public List<Supply> findAllSupply();
```



```sql
<select id="findAllSupply" resultType="com.pn.entity.Supply">
    select *
    from supply
    where is_delete = 0
</select>
```



### 2.2.2 Service

```java
@CacheConfig(cacheNames = "com.pn.service.impl.SupplyServiceImpl")
@Service
public class SupplyServiceImpl implements SupplyService {
    @Autowired
    private SupplyMapper supplyMapper;

    @Cacheable(key = "'all:supply'")
    @Override
    public List<Supply> supplyMapper() {
        return supplyMapper.findAllSupply();
    }
}
```



### 2.2.3 Controller

```java
@Autowired
private SupplyService supplyService;

// 查询所有供应商的接口
@RequestMapping("/supply-list")
public Result supplyList(){
    return Result.ok(supplyService.supplyMapper());
}
```

### 2.2.4 效果图

![image-20230815223134896](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815223134896.png)

## 2.3 查询所有产地

### 2.3.1 Mapper

```java
//查询所有产地
public List<Place> findAllPlace();
```



```xml
<select id="findAllPlace" resultType="com.pn.entity.Place">
    select * from place
</select>
```



### 2.3.2 Service

```java
//指定缓存的名称即键的前缀,一般是@CacheConfig标注的类的全类名
@CacheConfig(cacheNames = "com.pn.service.impl.PlaceServiceImpl")
@Service
public class PlaceServiceImpl implements PlaceService {

    //注入PlaceMapper
    @Autowired
    private PlaceMapper placeMapper;

    /*
      查询所有产地的业务方法
     */
    //对查询到的所有产地进行缓存,缓存到redis的键为all:place
    @Cacheable(key = "'all:place'")
    @Override
    public List<Place> queryAllPlace() {
        //查询所有产地
        return placeMapper.findAllPlace();
    }
}
```



### 2.3.3 Controller

```java
    @RequestMapping("/place-list")
    public Result placeList(){
//      执行业务
        return Result.ok(placeService.queryAllPlace());
    }
```

### 2.3.4 效果图

![image-20230815223157406](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815223157406.png)

## 2.4  查询所有单位

### 2.4.1 Mapper

```java
//查询所有单位的方法
public List<Unit> findAllUnit();
```



```xml
<select id="findAllUnit" resultType="com.pn.entity.Unit">
    select * from unit
</select>
```

### 2.4.2 Service

```java
//指定缓存的名称即键的前缀,一般是@CacheConfig标注的类的全类名
@CacheConfig(cacheNames = "com.pn.service.impl.UnitServiceImpl")
@Service
public class UnitServiceImpl implements UnitService {

    //注入UnitMapper
    @Autowired
    private UnitMapper unitMapper;

    /*
      查询所有单位的业务方法
     */
    //对查询到的所有单位进行缓存,缓存到redis的键为all:unit
    @Cacheable(key = "'all:unit'")
    @Override
    public List<Unit> queryAllUnit() {
        //查询所有单位
        return unitMapper.findAllUnit();
    }
}
```

### 2.4.3 Controller

```java
    @RequestMapping("/unit-list")
    public Result unitList(){
//      执行业务
        return Result.ok(unitService.queryAllUnit());
    }
```

### 2.4.4 效果图

![image-20230815223220207](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230815223220207.png)





## 2.5 上传图片



## 2.5 添加商品

